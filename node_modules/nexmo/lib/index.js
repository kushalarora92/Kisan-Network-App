'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

var https = require('https');
var http = require('http');
var querystring = require('querystring');

var headers = {
    'Content-Type': 'application/x-www-form-urlencoded',
    'accept': 'application/json'
};
var initialized = false;
var username = '';
var password = '';
var msgpath = { host: 'rest.nexmo.com', path: '/sms/json' };
var shortcodePath = { host: 'rest.nexmo.com', path: '/sc/us/${type}/json' };
var ttsEndpoint = { host: 'api.nexmo.com', path: '/tts/json' };
var ttsPromptEndpoint = { host: 'api.nexmo.com', path: '/tts-prompt/json' };
var callEndpoint = { host: 'rest.nexmo.com', path: '/call/json' };
var verifyEndpoint = { host: 'api.nexmo.com', path: '/verify/json' };
var checkVerifyEndpoint = { host: 'api.nexmo.com', path: '/verify/check/json' };
var controlVerifyEndpoint = { host: 'api.nexmo.com', path: '/verify/control/json' };
var searchVerifyEndpoint = { host: 'api.nexmo.com', path: '/verify/search/json' };
var niEndpoint = { host: 'rest.nexmo.com', path: '/ni/json' };
var niBasicEndpoint = { host: 'api.nexmo.com', path: '/number/format/json' };
var niStandardEndpoint = { host: 'api.nexmo.com', path: '/number/lookup/json' };
var applicationsEndpoint = { host: 'api.nexmo.com', path: '/beta/account/applications' };
var up = {};
var debugOn = false;
var port = 443;
var numberPattern = new RegExp("^[0-9 +()-]*$");

//Error message resources are maintained globally in one place for easy management
var ERROR_MESSAGES = {
    sender: 'Invalid from address',
    to: 'Invalid to address',
    msg: 'Invalid Text Message',
    msgParams: 'Invalid shortcode message parameters',
    countrycode: 'Invalid Country Code',
    msisdn: 'Invalid MSISDN passed',
    body: 'Invalid Body value in Binary Message',
    udh: 'Invalid udh value in Binary Message',
    title: 'Invalid title in WAP Push message',
    url: 'Invalid url in WAP Push message',
    maxDigits: 'Invalid max digits for TTS prompt',
    byeText: 'Invalid bye text for TTS prompt',
    pinCode: 'Invalid pin code for TTS confirm',
    failedText: 'Invalid failed text for TTS confirm',
    answerUrl: 'Invalid answer URL for call',
    verifyValidation: 'Missing Mandatory fields (number and/or brand)',
    checkVerifyValidation: 'Missing Mandatory fields (request_id and/or code)',
    controlVerifyValidation: 'Missing Mandatory fields (request_id and/or cmd-command)',
    searchVerifyValidation: 'Missing Mandatory fields (request_id or request_ids)',
    numberInsightAdvancedValidation: 'Missing Mandatory fields (number and/or callback url)',
    numberInsightValidation: 'Missing Mandatory field - number',
    numberInsightPatternFailure: 'Number can contain digits and may include any or all of the following: white space, -,+, (, ).',
    optionsNotAnObject: 'Options parameter should be a dictionary. Check the docs for valid properties for options',
    applicationName: 'Invalid argument: name',
    applicationType: 'Invalid argument: type (valid options: [voice])',
    applicationAnswerUrl: 'Invalid argument: answerUrl',
    applicationEventUrl: 'Invalid argument: eventUrl',
    applicationId: 'Invalid argument: appId',
    product: 'Invalid product. Should be one of [voice, sms]'
};

// debugon is optional
exports.initialize = function (pkey, psecret, debugon) {
    if (!pkey || !psecret) {
        throw 'key and secret cannot be empty, set valid values';
    }
    username = pkey;
    password = psecret;
    up = {
        api_key: pkey,
        api_secret: psecret
    };
    debugOn = !debugon ? false : String(debugon) === "false" ? false : true;
    initialized = true;
};

exports.sendBinaryMessage = function (sender, recipient, body, udh, callback) {
    if (!body) {
        sendError(callback, new Error(ERROR_MESSAGES.body));
    } else if (!udh) {
        sendError(callback, new Error(ERROR_MESSAGES.udh));
    } else {
        sendMessage({
            from: sender,
            to: recipient,
            type: 'binary',
            body: body,
            udh: udh
        }, callback);
    }
};

exports.sendWapPushMessage = function (sender, recipient, title, url, validity, callback) {
    if (!title) {
        sendError(callback, new Error(ERROR_MESSAGES.title));
    } else if (!url) {
        sendError(callback, new Error(ERROR_MESSAGES.url));
    } else {
        if (typeof validity == 'function') {
            callback = validity;
            validity = 86400000;
        }
        sendMessage({
            from: sender,
            to: recipient,
            type: 'wappush',
            title: title,
            validity: validity,
            url: url
        }, callback);
    }
};

exports.sendTextMessage = function (sender, recipient, message, opts, callback) {
    if (!message) {
        sendError(callback, new Error(ERROR_MESSAGES.msg));
    } else {
        if (!callback) {
            callback = opts;
            opts = {};
        }
        opts['from'] = sender;
        opts['to'] = recipient;
        opts['text'] = message;
        sendMessage(opts, callback);
    }
};

exports.sendMessage = function (opts, callback) {
    sendMessage(opts, callback);
};
function sendMessage(data, callback) {
    if (!data.from) {
        sendError(callback, new Error(ERROR_MESSAGES.sender));
    } else if (!data.to) {
        sendError(callback, new Error(ERROR_MESSAGES.to));
    } else {
        var path = clone(msgpath);
        path.path += '?' + querystring.stringify(data);
        log('sending message from ' + data.from + ' to ' + data.to + ' with message ' + data.text);
        sendRequest(path, 'POST', function (err, apiResponse) {
            if (!err && apiResponse.status && apiResponse.messages[0].status > 0) {
                sendError(callback, new Error(apiResponse.messages[0]['error-text']), apiResponse);
            } else {
                if (callback) callback(err, apiResponse);
            }
        });
    }
}

function sendViaShortcode(type, recipient, messageParams, opts, callback) {
    if (!recipient) {
        sendError(callback, new Error(ERROR_MESSAGES.to));
    }
    if (!messageParams || !Object.keys(messageParams)) {
        sendError(callback, new Error(ERROR_MESSAGES.msgParams));
    }
    opts = opts || {};
    var path = clone(shortcodePath);
    path.path = path.path.replace('${type}', type);
    Object.keys(messageParams).forEach(function (key) {
        opts[key] = messageParams[key];
    });
    opts.to = recipient;
    path.path += '?' + querystring.stringify(opts);
    log('sending message from shortcode ' + type + ' to ' + recipient + ' with parameters ' + JSON.stringify(messageParams));
    sendRequest(path, 'POST', function (err, apiResponse) {
        if (!err && apiResponse.status && apiResponse.messages[0].status > 0) {
            sendError(callback, new Error(apiResponse.messages[0]['error-text']), apiResponse);
        } else {
            if (callback) callback(err, apiResponse);
        }
    });
}
exports.shortcodeAlert = function (recipient, messageParams, opts, callback) {
    sendViaShortcode('alert', recipient, messageParams, opts, callback);
};
exports.shortcode2FA = function (recipient, messageParams, opts, callback) {
    sendViaShortcode('2fa', recipient, messageParams, opts, callback);
};
exports.shortcodeMarketing = function (recipient, messageParams, opts, callback) {
    sendViaShortcode('marketing', recipient, messageParams, opts, callback);
};

function clone(a) {
    return JSON.parse(JSON.stringify(a));
}

function getEndpoint(action) {
    return { path: action };
}

function sendRequest(endpoint, method, callback) {
    if (!initialized) {
        throw 'nexmo not initialized, call nexmo.initialize(username, password) first before calling any nexmo API';
    }
    if (typeof method == 'function') {
        callback = method;
        method = 'GET';
    }
    if (method == 'POST' || method == 'DELETE') headers['Content-Length'] = 0; // Fix broken due ot 411 Content-Length error now sent by Nexmo API
    var options = {
        host: endpoint.host ? endpoint.host : 'rest.nexmo.com',
        port: port,
        path: endpoint.path + (endpoint.path.indexOf('?') > 0 ? '&' : '?') + querystring.stringify(up),
        method: method,
        headers: headers
    };
    log(options);
    var request;
    if (true) {
        // set to false to verify the request without sending the actual request
        if (options.port == 443) {
            request = https.request(options);
        } else {
            request = http.request(options);
        }
        request.end();
        var responseReturn = '';
        request.on('response', function (response) {
            response.setEncoding('utf8');
            response.on('data', function (chunk) {
                responseReturn += chunk;
            });
            response.on('end', function () {
                log('response ended');
                if (callback) {
                    var retJson = responseReturn;
                    var err = null;
                    if (method !== 'DELETE') {
                        try {
                            retJson = JSON.parse(responseReturn);
                        } catch (parsererr) {
                            // ignore parser error for now and send raw response to client
                            log(parsererr);
                            log('could not convert API response to JSON, above error is ignored and raw API response is returned to client');
                            log('Raw Error message from API ');
                            log(responseReturn);
                            err = parsererr;
                        }
                    }
                    callback(err, retJson);
                }
            });
            response.on('close', function (e) {
                log('problem with API request detailed stacktrace below ');
                log(e);
                callback(e);
            });
        });
        request.on('error', function (e) {
            log('problem with API request detailed stacktrace below ');
            log(e);
            callback(e);
        });
    }
}

exports.checkBalance = function (callback) {
    var balanceEndpoint = getEndpoint('/account/get-balance');
    sendRequest(balanceEndpoint, callback);
};

exports.getPricing = function (countryCode, callback) {
    if (!countryCode || countryCode.length != 2) {
        sendError(callback, new Error(ERROR_MESSAGES.countrycode));
    } else {
        var pricingEndpoint = getEndpoint('/account/get-pricing/outbound');
        pricingEndpoint.path += '?country=' + countryCode;
        sendRequest(pricingEndpoint, callback);
    }
};

exports.getPhonePricing = function (product, msisdn, callback) {
    if (!product || product != 'sms' && product != 'voice') {
        sendError(callback, new Error(ERROR_MESSAGES.product));
    } else if (!msisdn || msisdn.length < 10) {
        // check if MSISDN validation is correct for international numbers
        sendError(callback, new Error(ERROR_MESSAGES.msisdn));
    } else {
        var pricingEndpoint = getEndpoint('/account/get-phone-pricing/outbound');
        pricingEndpoint.path += "/" + product + "/" + up.api_key + "/" + up.api_secret + "/" + msisdn;
        sendRequest(pricingEndpoint, callback);
    }
};

exports.getNumbers = function (options, callback) {
    var numbersEndpoint = getEndpoint('/account/numbers');
    if (typeof options == 'function') {
        callback = options;
    } else if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) == 'object') {
        numbersEndpoint.path = numbersEndpoint.path + '?';
        for (var key in options) {
            numbersEndpoint.path = numbersEndpoint.path + key + '=' + options[key] + '&';
        }
    } else {
        sendError(callback, new Error(ERROR_MESSAGES.optionsNotAnObject));
        return;
    }
    sendRequest(numbersEndpoint, callback);
};

exports.searchNumbers = function (countryCode, pattern, callback) {
    if (!countryCode || countryCode.length != 2) {
        sendError(callback, new Error(ERROR_MESSAGES.countrycode));
    } else {
        var searchEndpoint = getEndpoint('/number/search');
        searchEndpoint.path += '?country=' + countryCode;
        if (typeof pattern == 'function') {
            callback = pattern;
        } else if ((typeof pattern === 'undefined' ? 'undefined' : _typeof(pattern)) == 'object') {
            searchEndpoint.path = searchEndpoint.path + '&';
            for (var arg in pattern) {
                searchEndpoint.path = searchEndpoint.path + arg + '=' + pattern[arg] + '&';
            }
        } else {
            searchEndpoint.path = searchEndpoint.path + '&pattern=' + pattern;
        }
        sendRequest(searchEndpoint, callback);
    }
};

exports.buyNumber = function (countryCode, msisdn, callback) {
    if (!countryCode || countryCode.length != 2) {
        sendError(callback, new Error(ERROR_MESSAGES.countrycode));
    } else if (!msisdn || msisdn.length < 10) {
        // check if MSISDN validation is correct for international numbers
        sendError(callback, new Error(ERROR_MESSAGES.msisdn));
    } else {
        var buyEndpoint = getEndpoint('/number/buy');
        buyEndpoint.path += '?country=' + countryCode + '&msisdn=' + msisdn;
        sendRequest(buyEndpoint, 'POST', callback);
    }
};

exports.cancelNumber = function (countryCode, msisdn, callback) {
    if (!countryCode || countryCode.length != 2) {
        sendError(callback, new Error(ERROR_MESSAGES.countrycode));
    } else if (!msisdn || msisdn.length < 10) {
        sendError(callback, new Error(ERROR_MESSAGES.msisdn));
    } else {
        var cancelEndpoint = getEndpoint('/number/cancel');
        cancelEndpoint.path += '?country=' + countryCode + '&msisdn=' + msisdn;
        sendRequest(cancelEndpoint, 'POST', callback);
    }
};

exports.cancelNumber = function (countryCode, msisdn, callback) {
    if (!countryCode || countryCode.length != 2) {
        sendError(callback, new Error(ERROR_MESSAGES.countrycode));
    } else if (!msisdn || msisdn.length < 10) {
        sendError(callback, new Error(ERROR_MESSAGES.msisdn));
    } else {
        var cancelEndpoint = getEndpoint('/number/cancel');
        cancelEndpoint.path += '?country=' + countryCode + '&msisdn=' + msisdn;
        sendRequest(cancelEndpoint, 'POST', callback);
    }
};

exports.updateNumber = function (countryCode, msisdn, params, callback) {
    if (!countryCode || countryCode.length != 2) {
        sendError(callback, new Error(ERROR_MESSAGES.countrycode));
    } else if (!msisdn || msisdn.length < 10) {
        sendError(callback, new Error(ERROR_MESSAGES.msisdn));
    } else {
        var updateEndpoint = getEndpoint('/number/update');
        updateEndpoint.path += '?country=' + countryCode + '&msisdn=' + msisdn;
        updateEndpoint.path = updateEndpoint.path + '&';
        for (var arg in params) {
            updateEndpoint.path = updateEndpoint.path + arg + '=' + encodeURIComponent(params[arg]) + '&';
        }
        sendRequest(updateEndpoint, 'POST', callback);
    }
};

exports.getApplications = function (options, callback) {
    var endpoint = getEndpoint(applicationsEndpoint.path);
    endpoint.host = applicationsEndpoint.host;
    if (typeof options == 'function') {
        callback = options;
    } else if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) == 'object') {
        endpoint.path += '?';
        for (var key in options) {
            endpoint.path += key + '=' + options[key] + '&';
        }
    } else {
        sendError(callback, new Error(ERROR_MESSAGES.optionsNotAnObject));
        return;
    }
    sendRequest(endpoint, callback);
};

exports.createApplication = function (name, type, answerUrl, eventUrl, options, callback) {
    if (!name || name.length < 1) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationName));
    } else if (!type || type != 'voice') {
        sendError(callback, new Error(ERROR_MESSAGES.applicationType));
    } else if (!answerUrl) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationAnswerUrl));
    } else if (!eventUrl) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationEventUrl));
    } else {
        var createEndpoint = getEndpoint(applicationsEndpoint.path);
        createEndpoint.host = applicationsEndpoint.host;
        createEndpoint.path += '?name=' + encodeURIComponent(name) + '&type=' + type + '&answer_url=' + answerUrl + '&event_url=' + eventUrl;
        for (var key in options) {
            createEndpoint.path += '&' + key + '=' + options[key];
        }
        sendRequest(createEndpoint, 'POST', callback);
    }
};

exports.getApplication = function (appId, callback) {
    if (!appId || appId.length < 36) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationId));
    } else {
        var showEndpoint = getEndpoint(applicationsEndpoint.path + "/" + appId);
        showEndpoint.host = applicationsEndpoint.host;
        sendRequest(showEndpoint, callback);
    }
};

exports.updateApplication = function (appId, name, type, answerUrl, eventUrl, options, callback) {
    if (!appId || appId.length < 36) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationId));
    } else if (!name || name.length < 1) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationName));
    } else if (!type || type != 'voice') {
        sendError(callback, new Error(ERROR_MESSAGES.applicationType));
    } else if (!answerUrl) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationAnswerUrl));
    } else if (!eventUrl) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationEventUrl));
    } else {
        var updateEndpoint = getEndpoint(applicationsEndpoint.path + "/" + appId);
        updateEndpoint.path += '?name=' + encodeURIComponent(name) + '&type=' + type + '&answer_url=' + answerUrl + '&event_url=' + eventUrl;
        updateEndpoint.host = applicationsEndpoint.host;
        for (var key in options) {
            updateEndpoint.path = updateEndpoint.path + '&' + key + '=' + options[key];
        }
        sendRequest(updateEndpoint, 'PUT', callback);
    }
};

exports.deleteApplication = function (appId, callback) {
    if (!appId || appId.length < 36) {
        sendError(callback, new Error(ERROR_MESSAGES.applicationId));
    } else {
        var deleteEndpoint = getEndpoint(applicationsEndpoint.path + "/" + appId);
        deleteEndpoint.host = applicationsEndpoint.host;
        sendRequest(deleteEndpoint, 'DELETE', callback);
    }
};

exports.changePassword = function (newSecret, callback) {
    var settingsEndpoint = getEndpoint('/account/settings');
    settingsEndpoint.path += '?newSecret=' + encodeURIComponent(newSecret);
    sendRequest(settingsEndpoint, 'POST', callback);
};

exports.changeMoCallbackUrl = function (newUrl, callback) {
    var settingsEndpoint = getEndpoint('/account/settings');
    settingsEndpoint.path += '?moCallBackUrl=' + encodeURIComponent(newUrl);
    sendRequest(settingsEndpoint, 'POST', callback);
};

exports.changeDrCallbackUrl = function (newUrl, callback) {
    var settingsEndpoint = getEndpoint('/account/settings');
    settingsEndpoint.path += '?drCallBackUrl=' + encodeURIComponent(newUrl);
    sendRequest(settingsEndpoint, 'POST', callback);
};

exports.verifyNumber = function (inputParams, callback) {
    if (!inputParams.number || !inputParams.brand) {
        sendError(callback, new Error(ERROR_MESSAGES.verifyValidation));
    } else {
        var vEndpoint = clone(verifyEndpoint);
        vEndpoint.path += '?' + querystring.stringify(inputParams);
        sendRequest(vEndpoint, callback);
    }
};

exports.checkVerifyRequest = function (inputParams, callback) {
    if (!inputParams.request_id || !inputParams.code) {
        sendError(callback, new Error(ERROR_MESSAGES.checkVerifyValidation));
    } else {
        var vEndpoint = clone(checkVerifyEndpoint);
        vEndpoint.path += '?' + querystring.stringify(inputParams);
        sendRequest(vEndpoint, callback);
    }
};

exports.controlVerifyRequest = function (inputParams, callback) {
    if (!inputParams.request_id || !inputParams.cmd) {
        sendError(callback, new Error(ERROR_MESSAGES.controlVerifyValidation));
    } else {
        var vEndpoint = clone(controlVerifyEndpoint);
        vEndpoint.path += '?' + querystring.stringify(inputParams);
        sendRequest(vEndpoint, callback);
    }
};

exports.searchVerifyRequest = function (requestIds, callback) {
    var requestIdParam = {};
    if (!requestIds) {
        sendError(callback, new Error(ERROR_MESSAGES.searchVerifyValidation));
    } else {
        if (Array.isArray(requestIds)) {
            if (requestIds.length == 1) {
                requestIdParam.request_id = requestIds;
            } else {
                requestIdParam.request_ids = requestIds;
            }
        } else {
            requestIdParam.request_id = requestIds;
        }
        var vEndpoint = clone(searchVerifyEndpoint);
        vEndpoint.path += '?' + querystring.stringify(requestIdParam);
        sendRequest(vEndpoint, callback);
    }
};

exports.numberInsight = function (inputParams, callback) {
    if (!inputParams.number || !inputParams.callback) {
        sendError(callback, new Error(ERROR_MESSAGES.numberInsightAdvancedValidation));
    } else {
        var nEndpoint = clone(niEndpoint);
        nEndpoint.path += '?' + querystring.stringify(inputParams);
        sendRequest(nEndpoint, callback);
    }
};

exports.numberInsightBasic = function (inputParams, callback) {
    numberInsightCommon(niBasicEndpoint, inputParams, callback);
};

exports.numberInsightStandard = function (inputParams, callback) {
    numberInsightCommon(niStandardEndpoint, inputParams, callback);
};

function numberInsightCommon(endpoint, inputParams, callback) {
    if (validateNumber(inputParams, callback)) {
        var inputObj;
        if ((typeof inputParams === 'undefined' ? 'undefined' : _typeof(inputParams)) != 'object') {
            inputObj = { number: inputParams };
        } else {
            inputObj = inputParams;
        }
        var nEndpoint = clone(endpoint);
        nEndpoint.path += '?' + querystring.stringify(inputObj);
        sendRequest(nEndpoint, callback);
    }
}
function validateNumber(inputParams, callback) {
    if ((typeof inputParams === 'undefined' ? 'undefined' : _typeof(inputParams)) == 'object' && !inputParams.number) {
        sendError(callback, new Error(ERROR_MESSAGES.numberInsightValidation));
        return false;
    } else if ((typeof inputParams === 'undefined' ? 'undefined' : _typeof(inputParams)) == 'object' && !numberPattern.test(inputParams.number)) {
        sendError(callback, new Error(ERROR_MESSAGES.numberInsightPatternFailure));
        return false;
    } else if ((typeof inputParams === 'undefined' ? 'undefined' : _typeof(inputParams)) != 'object' && (!inputParams || !numberPattern.test(inputParams))) {
        sendError(callback, new Error(ERROR_MESSAGES.numberInsightPatternFailure));
        return false;
    }
    return true;
}

function sendVoiceMessage(voiceEndpoint, data, callback) {
    if (!data.to) {
        sendError(callback, new Error(ERROR_MESSAGES.to));
    } else {
        var endpoint = clone(voiceEndpoint);
        endpoint.path += '?' + querystring.stringify(data);
        log('sending TTS message to ' + data.to + ' with message ' + data.text);
        sendRequest(endpoint, 'POST', function (err, apiResponse) {
            if (!err && apiResponse.status && apiResponse.status > 0) {
                sendError(callback, new Error(apiResponse['error-text']), apiResponse);
            } else {
                if (callback) callback(err, apiResponse);
            }
        });
    }
}

exports.sendTTSMessage = function (recipient, message, opts, callback) {
    if (!message) {
        sendError(callback, new Error(ERROR_MESSAGES.msg));
    } else {
        if (!opts) {
            opts = {};
        }
        opts['to'] = recipient;
        opts['text'] = message;
        sendVoiceMessage(ttsEndpoint, opts, callback);
    }
};

exports.sendTTSPromptWithCapture = function (recipient, message, maxDigits, byeText, opts, callback) {
    if (!message) {
        sendError(callback, new Error(ERROR_MESSAGES.msg));
    } else if (!maxDigits || isNaN(maxDigits) || maxDigits.length > 16) {
        sendError(callback, new Error(ERROR_MESSAGES.maxDigits));
    } else if (!byeText) {
        sendError(callback, new Error(ERROR_MESSAGES.byeText));
    } else {
        if (!opts) {
            opts = {};
        }
        opts['to'] = recipient;
        opts['text'] = message;
        opts['max_digits'] = maxDigits;
        opts['bye_text'] = byeText;
        sendVoiceMessage(ttsPromptEndpoint, opts, callback);
    }
};

exports.sendTTSPromptWithConfirm = function (recipient, message, maxDigits, pinCode, byeText, failedText, opts, callback) {
    if (!message) {
        sendError(callback, new Error(ERROR_MESSAGES.msg));
    } else if (!maxDigits || isNaN(maxDigits) || maxDigits.length > 16) {
        sendError(callback, new Error(ERROR_MESSAGES.maxDigits));
    } else if (!pinCode || pinCode.length !== maxDigits) {
        sendError(callback, new Error(ERROR_MESSAGES.pinCode));
    } else if (!byeText) {
        sendError(callback, new Error(ERROR_MESSAGES.byeText));
    } else if (!failedText) {
        sendError(callback, new Error(ERROR_MESSAGES.failedText));
    } else {
        if (!opts) {
            opts = {};
        }
        opts['to'] = recipient;
        opts['text'] = message;
        opts['max_digits'] = maxDigits;
        opts['pin_code'] = pinCode;
        opts['bye_text'] = byeText;
        opts['failed_text'] = failedText;
        sendVoiceMessage(ttsPromptEndpoint, opts, callback);
    }
};

exports.call = function (recipient, answerUrl, opts, callback) {
    if (!answerUrl) {
        sendError(callback, new Error(ERROR_MESSAGES.answerUrl));
    } else {
        if (!opts) {
            opts = {};
        }
        opts['to'] = recipient;
        opts['answer_url'] = answerUrl;
        sendVoiceMessage(callEndpoint, opts, callback);
    }
};

function sendError(callback, err, returnData) {
    // Throw the error in case if there is no callback passed
    if (callback) {
        callback(err, returnData);
    } else {
        throw err;
    }
}

//Logging in one place to make it east to move to logging library like winston later.
function log(logMsg) {
    if (logMsg instanceof Error) console.log(logMsg.stack);
    if (debugOn) {
        if ((typeof logMsg === 'undefined' ? 'undefined' : _typeof(logMsg)) == 'object') {
            console.dir(logMsg);
        } else {
            console.log(logMsg);
        }
    }
}

exports.setHost = function (aHost) {
    msgpath.host = aHost;
    shortcodePath.host = aHost;
    ttsEndpoint.host = aHost;
    ttsPromptEndpoint.host = aHost;
    callEndpoint.host = aHost;
    verifyEndpoint.host = aHost;
    checkVerifyEndpoint.host = aHost;
    controlVerifyEndpoint.host = aHost;
    searchVerifyEndpoint.host = aHost;
    niEndpoint.host = aHost;
    niBasicEndpoint.host = aHost;
    niStandardEndpoint.host = aHost;
    applicationsEndpoint.host = aHost;
};

exports.setPort = function (aPort) {
    port = aPort;
};
//# sourceMappingURL=data:application/json;base64,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QUksa0JBQWtCLEtBQXRCLEVBQTZCLFFBQVEsR0FBUixDQUFZLE9BQU8sS0FBbkI7QUFDN0IsUUFBSSxPQUFKLEVBQWE7QUFDVCxZQUFJLFFBQU8sTUFBUCx5Q0FBTyxNQUFQLE1BQWlCLFFBQXJCLEVBQStCO0FBQzNCLG9CQUFRLEdBQVIsQ0FBWSxNQUFaO0FBQ0gsU0FGRCxNQUVPO0FBQ0gsb0JBQVEsR0FBUixDQUFZLE1BQVo7QUFDSDtBQUNKO0FBQ0o7O0FBRUQsUUFBUSxPQUFSLEdBQWtCLFVBQVMsS0FBVCxFQUFnQjtBQUM5QixZQUFRLElBQVIsR0FBZSxLQUFmO0FBQ0Esa0JBQWMsSUFBZCxHQUFxQixLQUFyQjtBQUNBLGdCQUFZLElBQVosR0FBbUIsS0FBbkI7QUFDQSxzQkFBa0IsSUFBbEIsR0FBeUIsS0FBekI7QUFDQSxpQkFBYSxJQUFiLEdBQW9CLEtBQXBCO0FBQ0EsbUJBQWUsSUFBZixHQUFzQixLQUF0QjtBQUNBLHdCQUFvQixJQUFwQixHQUEyQixLQUEzQjtBQUNBLDBCQUFzQixJQUF0QixHQUE2QixLQUE3QjtBQUNBLHlCQUFxQixJQUFyQixHQUE0QixLQUE1QjtBQUNBLGVBQVcsSUFBWCxHQUFrQixLQUFsQjtBQUNILG9CQUFnQixJQUFoQixHQUF1QixLQUF2QjtBQUNBLHVCQUFtQixJQUFuQixHQUEwQixLQUExQjtBQUNDLHlCQUFxQixJQUFyQixHQUE0QixLQUE1QjtBQUNELENBZEQ7O0FBZ0JBLFFBQVEsT0FBUixHQUFrQixVQUFTLEtBQVQsRUFBZ0I7QUFDaEMsV0FBTyxLQUFQO0FBQ0QsQ0FGRCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGh0dHBzID0gcmVxdWlyZSgnaHR0cHMnKTtcbnZhciBodHRwID0gcmVxdWlyZSgnaHR0cCcpO1xudmFyIHF1ZXJ5c3RyaW5nID0gcmVxdWlyZSgncXVlcnlzdHJpbmcnKTtcblxudmFyIGhlYWRlcnMgPSB7XG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICdhY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcbn07XG52YXIgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbnZhciB1c2VybmFtZSA9ICcnO1xudmFyIHBhc3N3b3JkID0gJyc7XG52YXIgbXNncGF0aCA9IHtob3N0OidyZXN0Lm5leG1vLmNvbScscGF0aDonL3Ntcy9qc29uJ307XG52YXIgc2hvcnRjb2RlUGF0aCA9IHtob3N0OidyZXN0Lm5leG1vLmNvbScscGF0aDonL3NjL3VzLyR7dHlwZX0vanNvbid9O1xudmFyIHR0c0VuZHBvaW50ID0ge2hvc3Q6J2FwaS5uZXhtby5jb20nLHBhdGg6Jy90dHMvanNvbid9O1xudmFyIHR0c1Byb21wdEVuZHBvaW50ID0ge2hvc3Q6J2FwaS5uZXhtby5jb20nLHBhdGg6Jy90dHMtcHJvbXB0L2pzb24nfTtcbnZhciBjYWxsRW5kcG9pbnQgPSB7aG9zdDoncmVzdC5uZXhtby5jb20nLHBhdGg6Jy9jYWxsL2pzb24nfTtcbnZhciB2ZXJpZnlFbmRwb2ludCA9IHtob3N0OidhcGkubmV4bW8uY29tJyxwYXRoOicvdmVyaWZ5L2pzb24nfTtcbnZhciBjaGVja1ZlcmlmeUVuZHBvaW50ID0ge2hvc3Q6J2FwaS5uZXhtby5jb20nLHBhdGg6Jy92ZXJpZnkvY2hlY2svanNvbid9O1xudmFyIGNvbnRyb2xWZXJpZnlFbmRwb2ludCA9IHtob3N0OidhcGkubmV4bW8uY29tJyxwYXRoOicvdmVyaWZ5L2NvbnRyb2wvanNvbid9O1xudmFyIHNlYXJjaFZlcmlmeUVuZHBvaW50ID0ge2hvc3Q6J2FwaS5uZXhtby5jb20nLHBhdGg6Jy92ZXJpZnkvc2VhcmNoL2pzb24nfTtcbnZhciBuaUVuZHBvaW50ID0ge2hvc3Q6J3Jlc3QubmV4bW8uY29tJyxwYXRoOicvbmkvanNvbid9O1xudmFyIG5pQmFzaWNFbmRwb2ludCA9IHtob3N0OidhcGkubmV4bW8uY29tJyxwYXRoOicvbnVtYmVyL2Zvcm1hdC9qc29uJ307XG52YXIgbmlTdGFuZGFyZEVuZHBvaW50ID0ge2hvc3Q6J2FwaS5uZXhtby5jb20nLHBhdGg6Jy9udW1iZXIvbG9va3VwL2pzb24nfTtcbnZhciBhcHBsaWNhdGlvbnNFbmRwb2ludCA9IHtob3N0OidhcGkubmV4bW8uY29tJyxwYXRoOicvYmV0YS9hY2NvdW50L2FwcGxpY2F0aW9ucyd9O1xudmFyIHVwID0ge307XG52YXIgZGVidWdPbiA9IGZhbHNlO1xudmFyIHBvcnQgPSA0NDM7XG52YXIgbnVtYmVyUGF0dGVybiA9IG5ldyBSZWdFeHAoXCJeWzAtOSArKCktXSokXCIpO1xuXG4vL0Vycm9yIG1lc3NhZ2UgcmVzb3VyY2VzIGFyZSBtYWludGFpbmVkIGdsb2JhbGx5IGluIG9uZSBwbGFjZSBmb3IgZWFzeSBtYW5hZ2VtZW50XG52YXIgRVJST1JfTUVTU0FHRVMgPSB7XG4gICAgc2VuZGVyOiAnSW52YWxpZCBmcm9tIGFkZHJlc3MnLFxuICAgIHRvOiAnSW52YWxpZCB0byBhZGRyZXNzJyxcbiAgICBtc2c6ICdJbnZhbGlkIFRleHQgTWVzc2FnZScsXG4gICAgbXNnUGFyYW1zOiAnSW52YWxpZCBzaG9ydGNvZGUgbWVzc2FnZSBwYXJhbWV0ZXJzJyxcbiAgICBjb3VudHJ5Y29kZTogJ0ludmFsaWQgQ291bnRyeSBDb2RlJyxcbiAgICBtc2lzZG46ICdJbnZhbGlkIE1TSVNETiBwYXNzZWQnLFxuICAgIGJvZHk6ICdJbnZhbGlkIEJvZHkgdmFsdWUgaW4gQmluYXJ5IE1lc3NhZ2UnLFxuICAgIHVkaDogJ0ludmFsaWQgdWRoIHZhbHVlIGluIEJpbmFyeSBNZXNzYWdlJyxcbiAgICB0aXRsZTogJ0ludmFsaWQgdGl0bGUgaW4gV0FQIFB1c2ggbWVzc2FnZScsXG4gICAgdXJsOiAnSW52YWxpZCB1cmwgaW4gV0FQIFB1c2ggbWVzc2FnZScsXG4gICAgbWF4RGlnaXRzOiAnSW52YWxpZCBtYXggZGlnaXRzIGZvciBUVFMgcHJvbXB0JyxcbiAgICBieWVUZXh0OiAnSW52YWxpZCBieWUgdGV4dCBmb3IgVFRTIHByb21wdCcsXG4gICAgcGluQ29kZTogJ0ludmFsaWQgcGluIGNvZGUgZm9yIFRUUyBjb25maXJtJyxcbiAgICBmYWlsZWRUZXh0OiAnSW52YWxpZCBmYWlsZWQgdGV4dCBmb3IgVFRTIGNvbmZpcm0nLFxuICAgIGFuc3dlclVybDogJ0ludmFsaWQgYW5zd2VyIFVSTCBmb3IgY2FsbCcsXG5cdHZlcmlmeVZhbGlkYXRpb246J01pc3NpbmcgTWFuZGF0b3J5IGZpZWxkcyAobnVtYmVyIGFuZC9vciBicmFuZCknLFxuXHRjaGVja1ZlcmlmeVZhbGlkYXRpb246J01pc3NpbmcgTWFuZGF0b3J5IGZpZWxkcyAocmVxdWVzdF9pZCBhbmQvb3IgY29kZSknLFxuXHRjb250cm9sVmVyaWZ5VmFsaWRhdGlvbjonTWlzc2luZyBNYW5kYXRvcnkgZmllbGRzIChyZXF1ZXN0X2lkIGFuZC9vciBjbWQtY29tbWFuZCknLFxuXHRzZWFyY2hWZXJpZnlWYWxpZGF0aW9uOidNaXNzaW5nIE1hbmRhdG9yeSBmaWVsZHMgKHJlcXVlc3RfaWQgb3IgcmVxdWVzdF9pZHMpJyxcblx0bnVtYmVySW5zaWdodEFkdmFuY2VkVmFsaWRhdGlvbjonTWlzc2luZyBNYW5kYXRvcnkgZmllbGRzIChudW1iZXIgYW5kL29yIGNhbGxiYWNrIHVybCknLFxuXHRudW1iZXJJbnNpZ2h0VmFsaWRhdGlvbjonTWlzc2luZyBNYW5kYXRvcnkgZmllbGQgLSBudW1iZXInLFxuXHRudW1iZXJJbnNpZ2h0UGF0dGVybkZhaWx1cmU6J051bWJlciBjYW4gY29udGFpbiBkaWdpdHMgYW5kIG1heSBpbmNsdWRlIGFueSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZzogd2hpdGUgc3BhY2UsIC0sKywgKCwgKS4nLFxuXHRvcHRpb25zTm90QW5PYmplY3Q6J09wdGlvbnMgcGFyYW1ldGVyIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIENoZWNrIHRoZSBkb2NzIGZvciB2YWxpZCBwcm9wZXJ0aWVzIGZvciBvcHRpb25zJyxcbiAgICBhcHBsaWNhdGlvbk5hbWU6ICdJbnZhbGlkIGFyZ3VtZW50OiBuYW1lJyxcbiAgICBhcHBsaWNhdGlvblR5cGU6ICdJbnZhbGlkIGFyZ3VtZW50OiB0eXBlICh2YWxpZCBvcHRpb25zOiBbdm9pY2VdKScsXG4gICAgYXBwbGljYXRpb25BbnN3ZXJVcmw6ICdJbnZhbGlkIGFyZ3VtZW50OiBhbnN3ZXJVcmwnLFxuICAgIGFwcGxpY2F0aW9uRXZlbnRVcmw6ICdJbnZhbGlkIGFyZ3VtZW50OiBldmVudFVybCcsXG4gICAgYXBwbGljYXRpb25JZDogJ0ludmFsaWQgYXJndW1lbnQ6IGFwcElkJyxcbiAgICBwcm9kdWN0OiAnSW52YWxpZCBwcm9kdWN0LiBTaG91bGQgYmUgb25lIG9mIFt2b2ljZSwgc21zXSdcbn07XG5cbi8vIGRlYnVnb24gaXMgb3B0aW9uYWxcbmV4cG9ydHMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKHBrZXksIHBzZWNyZXQsIGRlYnVnb24pIHtcbiAgICBpZiAoIXBrZXkgfHwgIXBzZWNyZXQpIHtcbiAgICAgICAgdGhyb3cgJ2tleSBhbmQgc2VjcmV0IGNhbm5vdCBiZSBlbXB0eSwgc2V0IHZhbGlkIHZhbHVlcyc7XG4gICAgfVxuICAgIHVzZXJuYW1lID0gcGtleTtcbiAgICBwYXNzd29yZCA9IHBzZWNyZXQ7XG4gICAgdXAgPSB7XG4gICAgICAgIGFwaV9rZXk6IHBrZXksXG4gICAgICAgIGFwaV9zZWNyZXQ6IHBzZWNyZXRcbiAgICB9XG4gICAgZGVidWdPbiA9ICFkZWJ1Z29uID8gZmFsc2UgOiAoU3RyaW5nKGRlYnVnb24pID09PSBcImZhbHNlXCIgPyBmYWxzZSA6IHRydWUpO1xuICAgIGluaXRpYWxpemVkID0gdHJ1ZTtcbn1cblxuZXhwb3J0cy5zZW5kQmluYXJ5TWVzc2FnZSA9IGZ1bmN0aW9uKHNlbmRlciwgcmVjaXBpZW50LCBib2R5LCB1ZGgsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFib2R5KSB7XG4gICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmJvZHkpKTtcbiAgICB9IGVsc2UgaWYgKCF1ZGgpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMudWRoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgZnJvbTogc2VuZGVyLFxuICAgICAgICAgICAgdG86IHJlY2lwaWVudCxcbiAgICAgICAgICAgIHR5cGU6ICdiaW5hcnknLFxuICAgICAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgICAgIHVkaDogdWRoXG4gICAgICAgIH0sIGNhbGxiYWNrKTtcbiAgICB9XG59XG5cbmV4cG9ydHMuc2VuZFdhcFB1c2hNZXNzYWdlID0gZnVuY3Rpb24oc2VuZGVyLCByZWNpcGllbnQsIHRpdGxlLCB1cmwsIHZhbGlkaXR5LCBjYWxsYmFjaykge1xuICAgIGlmICghdGl0bGUpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMudGl0bGUpKTtcbiAgICB9IGVsc2UgaWYgKCF1cmwpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMudXJsKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWxpZGl0eSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9IHZhbGlkaXR5O1xuICAgICAgICAgICAgdmFsaWRpdHkgPSA4NjQwMDAwMDtcbiAgICAgICAgfVxuICAgICAgICBzZW5kTWVzc2FnZSh7XG4gICAgICAgICAgICBmcm9tOiBzZW5kZXIsXG4gICAgICAgICAgICB0bzogcmVjaXBpZW50LFxuICAgICAgICAgICAgdHlwZTogJ3dhcHB1c2gnLFxuICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgdmFsaWRpdHk6IHZhbGlkaXR5LFxuICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgfSwgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy5zZW5kVGV4dE1lc3NhZ2UgPSBmdW5jdGlvbihzZW5kZXIsIHJlY2lwaWVudCwgbWVzc2FnZSwgb3B0cywgY2FsbGJhY2spIHtcbiAgICBpZiAoIW1lc3NhZ2UpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMubXNnKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFjYWxsYmFjaykge1xuXHQgICAgXHRjYWxsYmFjayA9IG9wdHM7XG4gICAgICAgICAgICBvcHRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgb3B0c1snZnJvbSddID0gc2VuZGVyO1xuICAgICAgICBvcHRzWyd0byddID0gcmVjaXBpZW50O1xuICAgICAgICBvcHRzWyd0ZXh0J10gPSBtZXNzYWdlO1xuICAgICAgICBzZW5kTWVzc2FnZShvcHRzLCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24ob3B0cywgY2FsbGJhY2spIHtcbiAgICAgICAgc2VuZE1lc3NhZ2Uob3B0cywgY2FsbGJhY2spO1xufVxuZnVuY3Rpb24gc2VuZE1lc3NhZ2UoZGF0YSwgY2FsbGJhY2spIHtcbiAgICBpZiAoIWRhdGEuZnJvbSkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5zZW5kZXIpKTtcbiAgICB9IGVsc2UgaWYgKCFkYXRhLnRvKSB7XG4gICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLnRvKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHBhdGggPSBjbG9uZShtc2dwYXRoKTtcblx0XHRwYXRoLnBhdGgrPSAnPycgKyBxdWVyeXN0cmluZy5zdHJpbmdpZnkoZGF0YSk7XG4gICAgICAgIGxvZygnc2VuZGluZyBtZXNzYWdlIGZyb20gJyArIGRhdGEuZnJvbSArICcgdG8gJyArIGRhdGEudG8gKyAnIHdpdGggbWVzc2FnZSAnICsgZGF0YS50ZXh0KTtcbiAgICAgICAgc2VuZFJlcXVlc3QocGF0aCwgJ1BPU1QnLCBmdW5jdGlvbihlcnIsIGFwaVJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIWVyciAmJiBhcGlSZXNwb25zZS5zdGF0dXMgJiYgYXBpUmVzcG9uc2UubWVzc2FnZXNbMF0uc3RhdHVzID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKGFwaVJlc3BvbnNlLm1lc3NhZ2VzWzBdWydlcnJvci10ZXh0J10pLCBhcGlSZXNwb25zZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZXJyLCBhcGlSZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc2VuZFZpYVNob3J0Y29kZSh0eXBlLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFyZWNpcGllbnQpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMudG8pKTtcbiAgICB9XG4gICAgaWYgKCFtZXNzYWdlUGFyYW1zIHx8ICFPYmplY3Qua2V5cyhtZXNzYWdlUGFyYW1zKSkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5tc2dQYXJhbXMpKTtcbiAgICB9XG4gICAgb3B0cyA9IG9wdHMgfHwge307XG4gICAgdmFyIHBhdGggPSBjbG9uZShzaG9ydGNvZGVQYXRoKTtcbiAgICBwYXRoLnBhdGggPSBwYXRoLnBhdGgucmVwbGFjZSgnJHt0eXBlfScsIHR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VQYXJhbXMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIG9wdHNba2V5XSA9IG1lc3NhZ2VQYXJhbXNba2V5XTtcbiAgICB9KTtcbiAgICBvcHRzLnRvID0gcmVjaXBpZW50O1xuICAgIHBhdGgucGF0aCs9ICc/JyArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShvcHRzKTtcbiAgICBsb2coJ3NlbmRpbmcgbWVzc2FnZSBmcm9tIHNob3J0Y29kZSAnICsgdHlwZSArICcgdG8gJyArIHJlY2lwaWVudCArICcgd2l0aCBwYXJhbWV0ZXJzICcgKyBKU09OLnN0cmluZ2lmeShtZXNzYWdlUGFyYW1zKSk7XG4gICAgc2VuZFJlcXVlc3QocGF0aCwgJ1BPU1QnLCBmdW5jdGlvbihlcnIsIGFwaVJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghZXJyICYmIGFwaVJlc3BvbnNlLnN0YXR1cyAmJiBhcGlSZXNwb25zZS5tZXNzYWdlc1swXS5zdGF0dXMgPiAwKSB7XG4gICAgICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihhcGlSZXNwb25zZS5tZXNzYWdlc1swXVsnZXJyb3ItdGV4dCddKSwgYXBpUmVzcG9uc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhlcnIsIGFwaVJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaG9ydGNvZGVBbGVydCA9IGZ1bmN0aW9uKHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICBzZW5kVmlhU2hvcnRjb2RlKCdhbGVydCcsIHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spO1xufVxuZXhwb3J0cy5zaG9ydGNvZGUyRkEgPSBmdW5jdGlvbihyZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgc2VuZFZpYVNob3J0Y29kZSgnMmZhJywgcmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjayk7XG59XG5leHBvcnRzLnNob3J0Y29kZU1hcmtldGluZyA9IGZ1bmN0aW9uKHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICBzZW5kVmlhU2hvcnRjb2RlKCdtYXJrZXRpbmcnLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKTtcbn1cblxuZnVuY3Rpb24gY2xvbmUoYSkge1xuICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYSkpO1xufVxuXG5mdW5jdGlvbiBnZXRFbmRwb2ludChhY3Rpb24pIHtcbiAgICByZXR1cm4ge3BhdGg6YWN0aW9ufTtcbn1cblxuZnVuY3Rpb24gc2VuZFJlcXVlc3QoZW5kcG9pbnQsIG1ldGhvZCwgY2FsbGJhY2spIHtcbiAgICBpZiAoIWluaXRpYWxpemVkKSB7XG4gICAgICAgIHRocm93ICduZXhtbyBub3QgaW5pdGlhbGl6ZWQsIGNhbGwgbmV4bW8uaW5pdGlhbGl6ZSh1c2VybmFtZSwgcGFzc3dvcmQpIGZpcnN0IGJlZm9yZSBjYWxsaW5nIGFueSBuZXhtbyBBUEknO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG1ldGhvZCA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWV0aG9kO1xuICAgICAgICBtZXRob2QgPSAnR0VUJztcbiAgICB9XG4gICAgaWYgKG1ldGhvZCA9PSAnUE9TVCcgfHwgbWV0aG9kID09ICdERUxFVEUnKVxuICAgICAgICBoZWFkZXJzWydDb250ZW50LUxlbmd0aCddID0gMDsgLy8gRml4IGJyb2tlbiBkdWUgb3QgNDExIENvbnRlbnQtTGVuZ3RoIGVycm9yIG5vdyBzZW50IGJ5IE5leG1vIEFQSVxuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBob3N0OiBlbmRwb2ludC5ob3N0P2VuZHBvaW50Lmhvc3Q6J3Jlc3QubmV4bW8uY29tJyxcbiAgICAgICAgcG9ydDogcG9ydCxcbiAgICAgICAgcGF0aDogZW5kcG9pbnQucGF0aCArIChlbmRwb2ludC5wYXRoLmluZGV4T2YoJz8nKT4wPycmJzonPycpICsgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHVwKSxcbiAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICB9O1xuICAgIGxvZyhvcHRpb25zKTtcbiAgICB2YXIgcmVxdWVzdDtcblx0aWYgKHRydWUpIHsgLy8gc2V0IHRvIGZhbHNlIHRvIHZlcmlmeSB0aGUgcmVxdWVzdCB3aXRob3V0IHNlbmRpbmcgdGhlIGFjdHVhbCByZXF1ZXN0XG4gICAgICBpZiAob3B0aW9ucy5wb3J0ID09IDQ0Mykge1xuICAgICAgICAgIHJlcXVlc3QgPSBodHRwcy5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXF1ZXN0ID0gaHR0cC5yZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgfVxuXHQgICAgcmVxdWVzdC5lbmQoKTtcblx0ICAgIHZhciByZXNwb25zZVJldHVybiA9ICcnO1xuXHQgICAgcmVxdWVzdC5vbigncmVzcG9uc2UnLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHQgICAgICAgIHJlc3BvbnNlLnNldEVuY29kaW5nKCd1dGY4Jyk7XG5cdCAgICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbihjaHVuaykge1xuXHQgICAgICAgICAgICByZXNwb25zZVJldHVybiArPSBjaHVuaztcblx0ICAgICAgICB9KTtcblx0ICAgICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24oKSB7XG5cdCAgICAgICAgICAgIGxvZygncmVzcG9uc2UgZW5kZWQnKTtcblx0ICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG5cdCAgICAgICAgICAgICAgICB2YXIgcmV0SnNvbiA9IHJlc3BvbnNlUmV0dXJuO1xuXHQgICAgICAgICAgICAgICAgdmFyIGVyciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICBpZiAobWV0aG9kICE9PSAnREVMRVRFJykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICBcdCAgICAgICAgICAgICAgICAgICAgcmV0SnNvbiA9IEpTT04ucGFyc2UocmVzcG9uc2VSZXR1cm4pO1xuICBcdCAgICAgICAgICAgICAgICB9IGNhdGNoIChwYXJzZXJlcnIpIHtcbiAgXHQgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBwYXJzZXIgZXJyb3IgZm9yIG5vdyBhbmQgc2VuZCByYXcgcmVzcG9uc2UgdG8gY2xpZW50XG4gIFx0ICAgICAgICAgICAgICAgICAgICBsb2cocGFyc2VyZXJyKTtcbiAgXHQgICAgICAgICAgICAgICAgICAgIGxvZygnY291bGQgbm90IGNvbnZlcnQgQVBJIHJlc3BvbnNlIHRvIEpTT04sIGFib3ZlIGVycm9yIGlzIGlnbm9yZWQgYW5kIHJhdyBBUEkgcmVzcG9uc2UgaXMgcmV0dXJuZWQgdG8gY2xpZW50Jyk7XG4gIFx0XHRcdFx0XHRcdCAgICAgICAgICBsb2coJ1JhdyBFcnJvciBtZXNzYWdlIGZyb20gQVBJICcpO1xuICBcdFx0XHRcdFx0XHQgICAgICAgICAgbG9nKHJlc3BvbnNlUmV0dXJuKTtcbiAgXHQgICAgICAgICAgICAgICAgICAgIGVyciA9IHBhcnNlcmVycjtcbiAgXHQgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByZXRKc29uKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgIH0pXG5cdCAgICAgICAgcmVzcG9uc2Uub24oJ2Nsb3NlJywgZnVuY3Rpb24oZSkge1xuXHQgICAgICAgICAgICBsb2coJ3Byb2JsZW0gd2l0aCBBUEkgcmVxdWVzdCBkZXRhaWxlZCBzdGFja3RyYWNlIGJlbG93ICcpO1xuXHQgICAgICAgICAgICBsb2coZSk7XG5cdCAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuXHQgICAgICAgIH0pO1xuXHQgICAgfSk7XG5cdCAgICByZXF1ZXN0Lm9uKCdlcnJvcicsIGZ1bmN0aW9uKGUpIHtcblx0ICAgICAgICBsb2coJ3Byb2JsZW0gd2l0aCBBUEkgcmVxdWVzdCBkZXRhaWxlZCBzdGFja3RyYWNlIGJlbG93ICcpO1xuXHQgICAgICAgIGxvZyhlKTtcblx0ICAgICAgICBjYWxsYmFjayhlKTtcblx0ICAgIH0pO1xuXHR9XG59XG5cbmV4cG9ydHMuY2hlY2tCYWxhbmNlID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICB2YXIgYmFsYW5jZUVuZHBvaW50ID0gZ2V0RW5kcG9pbnQoJy9hY2NvdW50L2dldC1iYWxhbmNlJyk7XG4gICAgc2VuZFJlcXVlc3QoYmFsYW5jZUVuZHBvaW50LCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydHMuZ2V0UHJpY2luZyA9IGZ1bmN0aW9uKGNvdW50cnlDb2RlLCBjYWxsYmFjaykge1xuICAgIGlmICghY291bnRyeUNvZGUgfHwgY291bnRyeUNvZGUubGVuZ3RoICE9IDIpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMuY291bnRyeWNvZGUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcHJpY2luZ0VuZHBvaW50ID0gZ2V0RW5kcG9pbnQoJy9hY2NvdW50L2dldC1wcmljaW5nL291dGJvdW5kJyk7XG5cdFx0cHJpY2luZ0VuZHBvaW50LnBhdGggKz0gJz9jb3VudHJ5PScgKyBjb3VudHJ5Q29kZTtcbiAgICAgICAgc2VuZFJlcXVlc3QocHJpY2luZ0VuZHBvaW50LCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLmdldFBob25lUHJpY2luZyA9IGZ1bmN0aW9uKHByb2R1Y3QsIG1zaXNkbiwgY2FsbGJhY2spIHtcbiAgICBpZiAoIXByb2R1Y3QgfHwgKHByb2R1Y3QgIT0gJ3NtcycgJiYgcHJvZHVjdCAhPSAndm9pY2UnKSkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5wcm9kdWN0KSk7XG4gICAgfSBlbHNlIGlmICghbXNpc2RuIHx8IG1zaXNkbi5sZW5ndGggPCAxMCkgeyAvLyBjaGVjayBpZiBNU0lTRE4gdmFsaWRhdGlvbiBpcyBjb3JyZWN0IGZvciBpbnRlcm5hdGlvbmFsIG51bWJlcnNcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMubXNpc2RuKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHByaWNpbmdFbmRwb2ludCA9IGdldEVuZHBvaW50KCcvYWNjb3VudC9nZXQtcGhvbmUtcHJpY2luZy9vdXRib3VuZCcpO1xuXHRcdCAgICBwcmljaW5nRW5kcG9pbnQucGF0aCArPSBcIi9cIiArIHByb2R1Y3QgKyBcIi9cIiArIHVwLmFwaV9rZXkgKyBcIi9cIiArIHVwLmFwaV9zZWNyZXQgKyBcIi9cIiArIG1zaXNkbjtcbiAgICAgICAgc2VuZFJlcXVlc3QocHJpY2luZ0VuZHBvaW50LCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLmdldE51bWJlcnMgPSBmdW5jdGlvbihvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHZhciBudW1iZXJzRW5kcG9pbnQgPSBnZXRFbmRwb2ludCgnL2FjY291bnQvbnVtYmVycycpO1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnKXtcbiAgICAgICAgbnVtYmVyc0VuZHBvaW50LnBhdGggPSBudW1iZXJzRW5kcG9pbnQucGF0aCArICc/JztcbiAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMpe1xuICAgICAgICAgICAgbnVtYmVyc0VuZHBvaW50LnBhdGggPSBudW1iZXJzRW5kcG9pbnQucGF0aCArIGtleSArICc9JyArIG9wdGlvbnNba2V5XSArICcmJ1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMub3B0aW9uc05vdEFuT2JqZWN0KSk7XG5cdFx0cmV0dXJuO1xuICAgIH1cblx0c2VuZFJlcXVlc3QobnVtYmVyc0VuZHBvaW50LCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydHMuc2VhcmNoTnVtYmVycyA9IGZ1bmN0aW9uKGNvdW50cnlDb2RlLCBwYXR0ZXJuLCBjYWxsYmFjaykge1xuICAgIGlmICghY291bnRyeUNvZGUgfHwgY291bnRyeUNvZGUubGVuZ3RoICE9IDIpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMuY291bnRyeWNvZGUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgc2VhcmNoRW5kcG9pbnQgPSBnZXRFbmRwb2ludCgnL251bWJlci9zZWFyY2gnKSA7XG5cdFx0c2VhcmNoRW5kcG9pbnQucGF0aCArPSAnP2NvdW50cnk9JyArIGNvdW50cnlDb2RlXG4gICAgICAgIGlmICh0eXBlb2YgcGF0dGVybiA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9IHBhdHRlcm47XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhdHRlcm4gPT0gJ29iamVjdCcpe1xuICAgICAgICAgICAgc2VhcmNoRW5kcG9pbnQucGF0aCA9IHNlYXJjaEVuZHBvaW50LnBhdGggKyAnJic7XG4gICAgICAgICAgICBmb3IgKHZhciBhcmcgaW4gcGF0dGVybil7XG4gICAgICAgICAgICAgICAgc2VhcmNoRW5kcG9pbnQucGF0aCA9IHNlYXJjaEVuZHBvaW50LnBhdGggKyBhcmcgKyAnPScgKyBwYXR0ZXJuW2FyZ10gKyAnJidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNlYXJjaEVuZHBvaW50LnBhdGggPSBzZWFyY2hFbmRwb2ludC5wYXRoICsgJyZwYXR0ZXJuPScgKyBwYXR0ZXJuO1xuICAgICAgICB9XG4gICAgICAgIHNlbmRSZXF1ZXN0KHNlYXJjaEVuZHBvaW50LCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLmJ1eU51bWJlciA9IGZ1bmN0aW9uKGNvdW50cnlDb2RlLCBtc2lzZG4sIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFjb3VudHJ5Q29kZSB8fCBjb3VudHJ5Q29kZS5sZW5ndGggIT0gMikge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5jb3VudHJ5Y29kZSkpO1xuICAgIH0gZWxzZSBpZiAoIW1zaXNkbiB8fCBtc2lzZG4ubGVuZ3RoIDwgMTApIHsgLy8gY2hlY2sgaWYgTVNJU0ROIHZhbGlkYXRpb24gaXMgY29ycmVjdCBmb3IgaW50ZXJuYXRpb25hbCBudW1iZXJzXG4gICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLm1zaXNkbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBidXlFbmRwb2ludCA9IGdldEVuZHBvaW50KCcvbnVtYmVyL2J1eScpO1xuXHRcdGJ1eUVuZHBvaW50LnBhdGggKz0gJz9jb3VudHJ5PScgKyBjb3VudHJ5Q29kZSArICcmbXNpc2RuPScgKyBtc2lzZG47XG4gICAgICAgIHNlbmRSZXF1ZXN0KGJ1eUVuZHBvaW50LCAnUE9TVCcsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5cbmV4cG9ydHMuY2FuY2VsTnVtYmVyID0gZnVuY3Rpb24oY291bnRyeUNvZGUsIG1zaXNkbiwgY2FsbGJhY2spIHtcbiAgICBpZiAoIWNvdW50cnlDb2RlIHx8IGNvdW50cnlDb2RlLmxlbmd0aCAhPSAyKSB7XG4gICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmNvdW50cnljb2RlKSk7XG4gICAgfSBlbHNlIGlmICghbXNpc2RuIHx8IG1zaXNkbi5sZW5ndGggPCAxMCkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5tc2lzZG4pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2FuY2VsRW5kcG9pbnQgPSBnZXRFbmRwb2ludCgnL251bWJlci9jYW5jZWwnKTtcblx0XHRjYW5jZWxFbmRwb2ludC5wYXRoICs9ICc/Y291bnRyeT0nICsgY291bnRyeUNvZGUgKyAnJm1zaXNkbj0nICsgbXNpc2RuO1xuICAgICAgICBzZW5kUmVxdWVzdChjYW5jZWxFbmRwb2ludCwgJ1BPU1QnLCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLmNhbmNlbE51bWJlciA9IGZ1bmN0aW9uKGNvdW50cnlDb2RlLCBtc2lzZG4sIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFjb3VudHJ5Q29kZSB8fCBjb3VudHJ5Q29kZS5sZW5ndGggIT0gMikge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5jb3VudHJ5Y29kZSkpO1xuICAgIH0gZWxzZSBpZiAoIW1zaXNkbiB8fCBtc2lzZG4ubGVuZ3RoIDwgMTApIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMubXNpc2RuKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGNhbmNlbEVuZHBvaW50ID0gZ2V0RW5kcG9pbnQoJy9udW1iZXIvY2FuY2VsJyk7XG5cdFx0Y2FuY2VsRW5kcG9pbnQucGF0aCArPSAnP2NvdW50cnk9JyArIGNvdW50cnlDb2RlICsgJyZtc2lzZG49JyArIG1zaXNkbjtcbiAgICAgICAgc2VuZFJlcXVlc3QoY2FuY2VsRW5kcG9pbnQsICdQT1NUJywgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy51cGRhdGVOdW1iZXIgPSBmdW5jdGlvbihjb3VudHJ5Q29kZSwgbXNpc2RuLCBwYXJhbXMsIGNhbGxiYWNrKXtcbiAgICBpZiAoIWNvdW50cnlDb2RlIHx8IGNvdW50cnlDb2RlLmxlbmd0aCAhPSAyKSB7XG4gICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmNvdW50cnljb2RlKSk7XG4gICAgfSBlbHNlIGlmICghbXNpc2RuIHx8IG1zaXNkbi5sZW5ndGggPCAxMCkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5tc2lzZG4pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdXBkYXRlRW5kcG9pbnQgPSBnZXRFbmRwb2ludCgnL251bWJlci91cGRhdGUnKTtcblx0dXBkYXRlRW5kcG9pbnQucGF0aCArPSAnP2NvdW50cnk9JyArIGNvdW50cnlDb2RlICsgJyZtc2lzZG49JyArIG1zaXNkbjtcbiAgICAgICAgdXBkYXRlRW5kcG9pbnQucGF0aCA9IHVwZGF0ZUVuZHBvaW50LnBhdGggKyAnJic7XG4gICAgICAgIGZvciAodmFyIGFyZyBpbiBwYXJhbXMpe1xuICAgICAgICAgICAgdXBkYXRlRW5kcG9pbnQucGF0aCA9IHVwZGF0ZUVuZHBvaW50LnBhdGggKyBhcmcgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQocGFyYW1zW2FyZ10pICsgJyYnXG4gICAgICAgIH1cbiAgICAgICAgc2VuZFJlcXVlc3QodXBkYXRlRW5kcG9pbnQsICdQT1NUJywgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy5nZXRBcHBsaWNhdGlvbnMgPSBmdW5jdGlvbihvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHZhciBlbmRwb2ludCA9IGdldEVuZHBvaW50KGFwcGxpY2F0aW9uc0VuZHBvaW50LnBhdGgpO1xuICAgIGVuZHBvaW50Lmhvc3QgPSBhcHBsaWNhdGlvbnNFbmRwb2ludC5ob3N0O1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09ICdvYmplY3QnKXtcbiAgICAgICAgZW5kcG9pbnQucGF0aCArPSAnPyc7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBvcHRpb25zKXtcbiAgICAgICAgICAgIGVuZHBvaW50LnBhdGggKz0gKGtleSArICc9JyArIG9wdGlvbnNba2V5XSArICcmJyk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5vcHRpb25zTm90QW5PYmplY3QpKTtcbiAgXHQgICAgcmV0dXJuO1xuICAgIH1cbiAgc2VuZFJlcXVlc3QoZW5kcG9pbnQsIGNhbGxiYWNrKTtcbn1cblxuZXhwb3J0cy5jcmVhdGVBcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKG5hbWUsIHR5cGUsIGFuc3dlclVybCwgZXZlbnRVcmwsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmICghbmFtZSB8fCBuYW1lLmxlbmd0aCA8IDEpIHtcbiAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmFwcGxpY2F0aW9uTmFtZSkpO1xuICB9IGVsc2UgaWYgKCF0eXBlIHx8IHR5cGUgIT0gJ3ZvaWNlJykge1xuICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMuYXBwbGljYXRpb25UeXBlKSk7XG4gIH0gZWxzZSBpZiAoIWFuc3dlclVybCkge1xuICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMuYXBwbGljYXRpb25BbnN3ZXJVcmwpKTtcbiAgfSBlbHNlIGlmICghZXZlbnRVcmwpIHtcbiAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmFwcGxpY2F0aW9uRXZlbnRVcmwpKTtcbiAgfSBlbHNlIHtcbiAgICAgIHZhciBjcmVhdGVFbmRwb2ludCA9IGdldEVuZHBvaW50KGFwcGxpY2F0aW9uc0VuZHBvaW50LnBhdGgpO1xuICAgICAgY3JlYXRlRW5kcG9pbnQuaG9zdCA9IGFwcGxpY2F0aW9uc0VuZHBvaW50Lmhvc3Q7XG4gICAgICBjcmVhdGVFbmRwb2ludC5wYXRoICs9ICgnP25hbWU9JyArIGVuY29kZVVSSUNvbXBvbmVudChuYW1lKSArICcmdHlwZT0nICsgdHlwZSAgKyAnJmFuc3dlcl91cmw9JyArIGFuc3dlclVybCAgKyAnJmV2ZW50X3VybD0nICsgZXZlbnRVcmwpO1xuICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMpe1xuICAgICAgICAgIGNyZWF0ZUVuZHBvaW50LnBhdGggKz0gKCcmJyArIGtleSArICc9JyArIG9wdGlvbnNba2V5XSk7XG4gICAgICB9XG4gICAgICBzZW5kUmVxdWVzdChjcmVhdGVFbmRwb2ludCwgJ1BPU1QnLCBjYWxsYmFjayk7XG4gIH1cbn1cblxuZXhwb3J0cy5nZXRBcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKGFwcElkLCBjYWxsYmFjaykge1xuICBpZiAoIWFwcElkIHx8IGFwcElkLmxlbmd0aCA8IDM2KSB7XG4gICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5hcHBsaWNhdGlvbklkKSk7XG4gIH0gZWxzZSB7XG4gICAgICB2YXIgc2hvd0VuZHBvaW50ID0gZ2V0RW5kcG9pbnQoYXBwbGljYXRpb25zRW5kcG9pbnQucGF0aCArIFwiL1wiICsgYXBwSWQpO1xuICAgICAgc2hvd0VuZHBvaW50Lmhvc3QgPSBhcHBsaWNhdGlvbnNFbmRwb2ludC5ob3N0O1xuICAgICAgc2VuZFJlcXVlc3Qoc2hvd0VuZHBvaW50LCBjYWxsYmFjayk7XG4gIH1cbn1cblxuZXhwb3J0cy51cGRhdGVBcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKGFwcElkLCBuYW1lLCB0eXBlLCBhbnN3ZXJVcmwsIGV2ZW50VXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoIWFwcElkIHx8IGFwcElkLmxlbmd0aCA8IDM2KSB7XG4gICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5hcHBsaWNhdGlvbklkKSk7XG4gIH0gZWxzZSBpZiAoIW5hbWUgfHwgbmFtZS5sZW5ndGggPCAxKSB7XG4gICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5hcHBsaWNhdGlvbk5hbWUpKTtcbiAgfSBlbHNlIGlmICghdHlwZSB8fCB0eXBlICE9ICd2b2ljZScpIHtcbiAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmFwcGxpY2F0aW9uVHlwZSkpO1xuICB9IGVsc2UgaWYgKCFhbnN3ZXJVcmwpIHtcbiAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmFwcGxpY2F0aW9uQW5zd2VyVXJsKSk7XG4gIH0gZWxzZSBpZiAoIWV2ZW50VXJsKSB7XG4gICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5hcHBsaWNhdGlvbkV2ZW50VXJsKSk7XG4gIH0gZWxzZSB7XG4gICAgICB2YXIgdXBkYXRlRW5kcG9pbnQgPSBnZXRFbmRwb2ludChhcHBsaWNhdGlvbnNFbmRwb2ludC5wYXRoICsgXCIvXCIgKyBhcHBJZCk7XG4gICAgICB1cGRhdGVFbmRwb2ludC5wYXRoICs9ICgnP25hbWU9JyArIGVuY29kZVVSSUNvbXBvbmVudChuYW1lKSArICcmdHlwZT0nICsgdHlwZSAgKyAnJmFuc3dlcl91cmw9JyArIGFuc3dlclVybCAgKyAnJmV2ZW50X3VybD0nICsgZXZlbnRVcmwpO1xuICAgICAgdXBkYXRlRW5kcG9pbnQuaG9zdCA9IGFwcGxpY2F0aW9uc0VuZHBvaW50Lmhvc3Q7XG4gICAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucyl7XG4gICAgICAgICAgdXBkYXRlRW5kcG9pbnQucGF0aCA9IHVwZGF0ZUVuZHBvaW50LnBhdGggKyAnJicgKyBrZXkgKyAnPScgKyBvcHRpb25zW2tleV07XG4gICAgICB9XG4gICAgICBzZW5kUmVxdWVzdCh1cGRhdGVFbmRwb2ludCwgJ1BVVCcsIGNhbGxiYWNrKTtcbiAgfVxufVxuXG5leHBvcnRzLmRlbGV0ZUFwcGxpY2F0aW9uID0gZnVuY3Rpb24oYXBwSWQsIGNhbGxiYWNrKSB7XG4gIGlmICghYXBwSWQgfHwgYXBwSWQubGVuZ3RoIDwgMzYpIHtcbiAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmFwcGxpY2F0aW9uSWQpKTtcbiAgfSBlbHNlIHtcbiAgICAgIHZhciBkZWxldGVFbmRwb2ludCA9IGdldEVuZHBvaW50KGFwcGxpY2F0aW9uc0VuZHBvaW50LnBhdGggKyBcIi9cIiArIGFwcElkKTtcbiAgICAgIGRlbGV0ZUVuZHBvaW50Lmhvc3QgPSBhcHBsaWNhdGlvbnNFbmRwb2ludC5ob3N0O1xuICAgICAgc2VuZFJlcXVlc3QoZGVsZXRlRW5kcG9pbnQsICdERUxFVEUnLCBjYWxsYmFjayk7XG4gIH1cbn1cblxuXG5leHBvcnRzLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24obmV3U2VjcmV0LCBjYWxsYmFjaykge1xuICAgIHZhciBzZXR0aW5nc0VuZHBvaW50ID0gZ2V0RW5kcG9pbnQoJy9hY2NvdW50L3NldHRpbmdzJyk7XG5cdHNldHRpbmdzRW5kcG9pbnQucGF0aCArPSAnP25ld1NlY3JldD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KG5ld1NlY3JldCk7XG4gICAgc2VuZFJlcXVlc3Qoc2V0dGluZ3NFbmRwb2ludCwgJ1BPU1QnLCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydHMuY2hhbmdlTW9DYWxsYmFja1VybCA9IGZ1bmN0aW9uKG5ld1VybCwgY2FsbGJhY2spIHtcbiAgICB2YXIgc2V0dGluZ3NFbmRwb2ludCA9IGdldEVuZHBvaW50KCcvYWNjb3VudC9zZXR0aW5ncycpO1xuXHRzZXR0aW5nc0VuZHBvaW50LnBhdGggICs9ICc/bW9DYWxsQmFja1VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KG5ld1VybCk7XG4gICAgc2VuZFJlcXVlc3Qoc2V0dGluZ3NFbmRwb2ludCwgJ1BPU1QnLCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydHMuY2hhbmdlRHJDYWxsYmFja1VybCA9IGZ1bmN0aW9uKG5ld1VybCwgY2FsbGJhY2spIHtcbiAgICB2YXIgc2V0dGluZ3NFbmRwb2ludCA9IGdldEVuZHBvaW50KCcvYWNjb3VudC9zZXR0aW5ncycpO1xuXHRzZXR0aW5nc0VuZHBvaW50LnBhdGggICs9ICc/ZHJDYWxsQmFja1VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KG5ld1VybCk7XG4gICAgc2VuZFJlcXVlc3Qoc2V0dGluZ3NFbmRwb2ludCwgJ1BPU1QnLCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydHMudmVyaWZ5TnVtYmVyID0gZnVuY3Rpb24oaW5wdXRQYXJhbXMsIGNhbGxiYWNrKSB7XG5cdGlmICghaW5wdXRQYXJhbXMubnVtYmVyIHx8ICFpbnB1dFBhcmFtcy5icmFuZCApIHtcblx0XHRzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy52ZXJpZnlWYWxpZGF0aW9uKSk7XG4gICAgfSBlbHNlIHtcblx0XHR2YXIgdkVuZHBvaW50ID0gY2xvbmUodmVyaWZ5RW5kcG9pbnQpO1xuXHRcdHZFbmRwb2ludC5wYXRoICs9ICc/JyArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShpbnB1dFBhcmFtcyk7XG4gICAgICAgIHNlbmRSZXF1ZXN0KHZFbmRwb2ludCwgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy5jaGVja1ZlcmlmeVJlcXVlc3QgPSBmdW5jdGlvbihpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcblx0aWYgKCFpbnB1dFBhcmFtcy5yZXF1ZXN0X2lkIHx8ICFpbnB1dFBhcmFtcy5jb2RlICkge1xuXHRcdHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLmNoZWNrVmVyaWZ5VmFsaWRhdGlvbikpO1xuICAgIH0gZWxzZSB7XG5cdFx0dmFyIHZFbmRwb2ludCA9IGNsb25lKGNoZWNrVmVyaWZ5RW5kcG9pbnQpO1xuXHRcdHZFbmRwb2ludC5wYXRoICs9ICc/JyArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShpbnB1dFBhcmFtcyk7XG4gICAgICAgIHNlbmRSZXF1ZXN0KHZFbmRwb2ludCwgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy5jb250cm9sVmVyaWZ5UmVxdWVzdCA9IGZ1bmN0aW9uKGlucHV0UGFyYW1zLCBjYWxsYmFjaykge1xuXHRpZiAoIWlucHV0UGFyYW1zLnJlcXVlc3RfaWQgfHwgIWlucHV0UGFyYW1zLmNtZCApIHtcblx0XHRzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5jb250cm9sVmVyaWZ5VmFsaWRhdGlvbikpO1xuICAgIH0gZWxzZSB7XG5cdFx0dmFyIHZFbmRwb2ludCA9IGNsb25lKGNvbnRyb2xWZXJpZnlFbmRwb2ludCk7XG5cdFx0dkVuZHBvaW50LnBhdGggKz0gJz8nICsgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KGlucHV0UGFyYW1zKTtcbiAgICAgICAgc2VuZFJlcXVlc3QodkVuZHBvaW50LCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLnNlYXJjaFZlcmlmeVJlcXVlc3QgPSBmdW5jdGlvbihyZXF1ZXN0SWRzLCBjYWxsYmFjaykge1xuXHR2YXIgcmVxdWVzdElkUGFyYW0gPSB7fTtcblx0aWYgKCFyZXF1ZXN0SWRzKSB7XG5cdFx0c2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMuc2VhcmNoVmVyaWZ5VmFsaWRhdGlvbikpO1xuICAgIH0gZWxzZSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocmVxdWVzdElkcykgKSB7XG5cdFx0XHRpZiAocmVxdWVzdElkcy5sZW5ndGggPT0xKSB7XG5cdFx0XHRcdHJlcXVlc3RJZFBhcmFtLnJlcXVlc3RfaWQ9cmVxdWVzdElkcztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJlcXVlc3RJZFBhcmFtLnJlcXVlc3RfaWRzPXJlcXVlc3RJZHM7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlcXVlc3RJZFBhcmFtLnJlcXVlc3RfaWQ9cmVxdWVzdElkcztcblx0XHR9XG5cdFx0dmFyIHZFbmRwb2ludCA9IGNsb25lKHNlYXJjaFZlcmlmeUVuZHBvaW50KTtcblx0XHR2RW5kcG9pbnQucGF0aCArPSAnPycgKyBxdWVyeXN0cmluZy5zdHJpbmdpZnkocmVxdWVzdElkUGFyYW0pO1xuICAgICAgICBzZW5kUmVxdWVzdCh2RW5kcG9pbnQsIGNhbGxiYWNrKTtcbiAgICB9XG59XG5cbmV4cG9ydHMubnVtYmVySW5zaWdodCA9IGZ1bmN0aW9uKGlucHV0UGFyYW1zLCBjYWxsYmFjaykge1xuXHRpZiAoIWlucHV0UGFyYW1zLm51bWJlciB8fCAhIGlucHV0UGFyYW1zLmNhbGxiYWNrKSB7XG5cdFx0c2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMubnVtYmVySW5zaWdodEFkdmFuY2VkVmFsaWRhdGlvbikpO1xuICAgIH0gZWxzZSB7XG5cdFx0dmFyIG5FbmRwb2ludCA9IGNsb25lKG5pRW5kcG9pbnQpO1xuXHRcdG5FbmRwb2ludC5wYXRoICs9ICc/JyArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShpbnB1dFBhcmFtcyk7XG4gICAgICAgIHNlbmRSZXF1ZXN0KG5FbmRwb2ludCwgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy5udW1iZXJJbnNpZ2h0QmFzaWMgPSBmdW5jdGlvbihpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcblx0bnVtYmVySW5zaWdodENvbW1vbihuaUJhc2ljRW5kcG9pbnQsaW5wdXRQYXJhbXMsY2FsbGJhY2spXG59XG5cbmV4cG9ydHMubnVtYmVySW5zaWdodFN0YW5kYXJkID0gZnVuY3Rpb24oaW5wdXRQYXJhbXMsIGNhbGxiYWNrKSB7XG5cdG51bWJlckluc2lnaHRDb21tb24obmlTdGFuZGFyZEVuZHBvaW50LGlucHV0UGFyYW1zLGNhbGxiYWNrKVxufVxuXG5mdW5jdGlvbiBudW1iZXJJbnNpZ2h0Q29tbW9uKGVuZHBvaW50LGlucHV0UGFyYW1zLGNhbGxiYWNrKSB7XG5cdGlmICh2YWxpZGF0ZU51bWJlcihpbnB1dFBhcmFtcyxjYWxsYmFjaykpe1xuXHRcdHZhciBpbnB1dE9iajtcblx0XHRpZiAodHlwZW9mIGlucHV0UGFyYW1zICE9ICdvYmplY3QnKSB7XG5cdFx0XHRpbnB1dE9iaiA9IHtudW1iZXI6aW5wdXRQYXJhbXN9O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpbnB1dE9iaiA9IGlucHV0UGFyYW1zO1xuXHRcdH1cblx0XHR2YXIgbkVuZHBvaW50ID0gY2xvbmUoZW5kcG9pbnQpO1xuXHRcdG5FbmRwb2ludC5wYXRoICs9ICc/JyArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShpbnB1dE9iaik7XG5cdCAgICBzZW5kUmVxdWVzdChuRW5kcG9pbnQsIGNhbGxiYWNrKTtcblx0fVxufVxuZnVuY3Rpb24gdmFsaWRhdGVOdW1iZXIoaW5wdXRQYXJhbXMsY2FsbGJhY2spIHtcblx0aWYgKCh0eXBlb2YgaW5wdXRQYXJhbXMgPT0gJ29iamVjdCcpICYmICFpbnB1dFBhcmFtcy5udW1iZXIpIHtcblx0XHRcdHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLm51bWJlckluc2lnaHRWYWxpZGF0aW9uKSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdH0gZWxzZSBpZiAoKHR5cGVvZiBpbnB1dFBhcmFtcyA9PSAnb2JqZWN0JykgJiYgIW51bWJlclBhdHRlcm4udGVzdChpbnB1dFBhcmFtcy5udW1iZXIpKSB7XG5cdFx0XHRzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5udW1iZXJJbnNpZ2h0UGF0dGVybkZhaWx1cmUpKTtcblx0XHRcdHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKCh0eXBlb2YgaW5wdXRQYXJhbXMgIT0gJ29iamVjdCcpICYmICghaW5wdXRQYXJhbXMgfHwgIW51bWJlclBhdHRlcm4udGVzdChpbnB1dFBhcmFtcykpKXtcblx0XHRzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5udW1iZXJJbnNpZ2h0UGF0dGVybkZhaWx1cmUpKTtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0cmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIHNlbmRWb2ljZU1lc3NhZ2Uodm9pY2VFbmRwb2ludCwgZGF0YSwgY2FsbGJhY2spIHtcbiAgICBpZiAoIWRhdGEudG8pIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMudG8pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZW5kcG9pbnQgPSBjbG9uZSh2b2ljZUVuZHBvaW50KTtcblx0XHRlbmRwb2ludC5wYXRoICs9ICc/JyArIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShkYXRhKTtcbiAgICAgICAgbG9nKCdzZW5kaW5nIFRUUyBtZXNzYWdlIHRvICcgKyBkYXRhLnRvICsgJyB3aXRoIG1lc3NhZ2UgJyArIGRhdGEudGV4dCk7XG4gICAgICAgIHNlbmRSZXF1ZXN0KGVuZHBvaW50LCAnUE9TVCcsIGZ1bmN0aW9uKGVyciwgYXBpUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmICghZXJyICYmIGFwaVJlc3BvbnNlLnN0YXR1cyAmJiBhcGlSZXNwb25zZS5zdGF0dXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoYXBpUmVzcG9uc2VbJ2Vycm9yLXRleHQnXSksIGFwaVJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhlcnIsIGFwaVJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnRzLnNlbmRUVFNNZXNzYWdlID0gZnVuY3Rpb24ocmVjaXBpZW50LCBtZXNzYWdlLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIGlmICghbWVzc2FnZSkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5tc2cpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIW9wdHMpIHtcbiAgICAgICAgICAgIG9wdHMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBvcHRzWyd0byddID0gcmVjaXBpZW50O1xuICAgICAgICBvcHRzWyd0ZXh0J10gPSBtZXNzYWdlO1xuICAgICAgICBzZW5kVm9pY2VNZXNzYWdlKHR0c0VuZHBvaW50LCBvcHRzLCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLnNlbmRUVFNQcm9tcHRXaXRoQ2FwdHVyZSA9IGZ1bmN0aW9uKHJlY2lwaWVudCwgbWVzc2FnZSwgbWF4RGlnaXRzLCBieWVUZXh0LCBvcHRzLCBjYWxsYmFjaykge1xuICAgIGlmICghbWVzc2FnZSkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5tc2cpKTtcbiAgICB9IGVsc2UgaWYgKCFtYXhEaWdpdHMgfHwgaXNOYU4obWF4RGlnaXRzKSB8fCBtYXhEaWdpdHMubGVuZ3RoID4gMTYpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMubWF4RGlnaXRzKSk7XG4gICAgfSBlbHNlIGlmICghYnllVGV4dCkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5ieWVUZXh0KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFvcHRzKSB7XG4gICAgICAgICAgICBvcHRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgb3B0c1sndG8nXSA9IHJlY2lwaWVudDtcbiAgICAgICAgb3B0c1sndGV4dCddID0gbWVzc2FnZTtcbiAgICAgICAgb3B0c1snbWF4X2RpZ2l0cyddID0gbWF4RGlnaXRzO1xuICAgICAgICBvcHRzWydieWVfdGV4dCddID0gYnllVGV4dDtcbiAgICAgICAgc2VuZFZvaWNlTWVzc2FnZSh0dHNQcm9tcHRFbmRwb2ludCwgb3B0cywgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuZXhwb3J0cy5zZW5kVFRTUHJvbXB0V2l0aENvbmZpcm0gPSBmdW5jdGlvbihyZWNpcGllbnQsIG1lc3NhZ2UsIG1heERpZ2l0cywgcGluQ29kZSwgYnllVGV4dCwgZmFpbGVkVGV4dCwgb3B0cywgY2FsbGJhY2spIHtcbiAgICBpZiAoIW1lc3NhZ2UpIHtcbiAgICAgICAgc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoRVJST1JfTUVTU0FHRVMubXNnKSk7XG4gICAgfSBlbHNlIGlmICghbWF4RGlnaXRzIHx8IGlzTmFOKG1heERpZ2l0cykgfHwgbWF4RGlnaXRzLmxlbmd0aCA+IDE2KSB7XG4gICAgICAgIHNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKEVSUk9SX01FU1NBR0VTLm1heERpZ2l0cykpO1xuICAgIH0gZWxzZSBpZiAoIXBpbkNvZGUgfHwgcGluQ29kZS5sZW5ndGggIT09IG1heERpZ2l0cykge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5waW5Db2RlKSk7XG4gICAgfSBlbHNlIGlmICghYnllVGV4dCkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5ieWVUZXh0KSk7XG4gICAgfSBlbHNlIGlmICghZmFpbGVkVGV4dCkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5mYWlsZWRUZXh0KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFvcHRzKSB7XG4gICAgICAgICAgICBvcHRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgb3B0c1sndG8nXSA9IHJlY2lwaWVudDtcbiAgICAgICAgb3B0c1sndGV4dCddID0gbWVzc2FnZTtcbiAgICAgICAgb3B0c1snbWF4X2RpZ2l0cyddID0gbWF4RGlnaXRzO1xuICAgICAgICBvcHRzWydwaW5fY29kZSddID0gcGluQ29kZTtcbiAgICAgICAgb3B0c1snYnllX3RleHQnXSA9IGJ5ZVRleHQ7XG4gICAgICAgIG9wdHNbJ2ZhaWxlZF90ZXh0J10gPSBmYWlsZWRUZXh0O1xuICAgICAgICBzZW5kVm9pY2VNZXNzYWdlKHR0c1Byb21wdEVuZHBvaW50LCBvcHRzLCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5leHBvcnRzLmNhbGwgPSBmdW5jdGlvbihyZWNpcGllbnQsIGFuc3dlclVybCwgb3B0cywgY2FsbGJhY2spIHtcbiAgICBpZiAoIWFuc3dlclVybCkge1xuICAgICAgICBzZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5hbnN3ZXJVcmwpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIW9wdHMpIHtcbiAgICAgICAgICAgIG9wdHMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBvcHRzWyd0byddID0gcmVjaXBpZW50O1xuICAgICAgICBvcHRzWydhbnN3ZXJfdXJsJ10gPSBhbnN3ZXJVcmw7XG4gICAgICAgIHNlbmRWb2ljZU1lc3NhZ2UoY2FsbEVuZHBvaW50LCBvcHRzLCBjYWxsYmFjayk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzZW5kRXJyb3IoY2FsbGJhY2ssIGVyciwgcmV0dXJuRGF0YSkge1xuICAgIC8vIFRocm93IHRoZSBlcnJvciBpbiBjYXNlIGlmIHRoZXJlIGlzIG5vIGNhbGxiYWNrIHBhc3NlZFxuICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayhlcnIsIHJldHVybkRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICB9XG59XG5cbi8vTG9nZ2luZyBpbiBvbmUgcGxhY2UgdG8gbWFrZSBpdCBlYXN0IHRvIG1vdmUgdG8gbG9nZ2luZyBsaWJyYXJ5IGxpa2Ugd2luc3RvbiBsYXRlci5cbmZ1bmN0aW9uIGxvZyhsb2dNc2cpIHtcbiAgICBpZiAobG9nTXNnIGluc3RhbmNlb2YgRXJyb3IpIGNvbnNvbGUubG9nKGxvZ01zZy5zdGFjayk7XG4gICAgaWYgKGRlYnVnT24pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBsb2dNc2cgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZGlyKGxvZ01zZyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhsb2dNc2cpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnRzLnNldEhvc3QgPSBmdW5jdGlvbihhSG9zdCkge1xuICAgIG1zZ3BhdGguaG9zdCA9IGFIb3N0O1xuICAgIHNob3J0Y29kZVBhdGguaG9zdCA9IGFIb3N0O1xuICAgIHR0c0VuZHBvaW50Lmhvc3QgPSBhSG9zdDtcbiAgICB0dHNQcm9tcHRFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG4gICAgY2FsbEVuZHBvaW50Lmhvc3QgPSBhSG9zdDtcbiAgICB2ZXJpZnlFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG4gICAgY2hlY2tWZXJpZnlFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG4gICAgY29udHJvbFZlcmlmeUVuZHBvaW50Lmhvc3QgPSBhSG9zdDtcbiAgICBzZWFyY2hWZXJpZnlFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG4gICAgbmlFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG5cdG5pQmFzaWNFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG5cdG5pU3RhbmRhcmRFbmRwb2ludC5ob3N0ID0gYUhvc3Q7XG4gIGFwcGxpY2F0aW9uc0VuZHBvaW50Lmhvc3QgPSBhSG9zdDtcbn1cblxuZXhwb3J0cy5zZXRQb3J0ID0gZnVuY3Rpb24oYVBvcnQpIHtcbiAgcG9ydCA9IGFQb3J0O1xufVxuIl19